# Feature Specification: OpenAero平台商业闭环功能

**Feature Branch**: `005-platform-business-loop`  
**Created**: 2025-01-26  
**Status**: Draft  
**Input**: User description: "实现OpenAero平台的完整商业闭环功能，包括用户认证、创作者方案提交、审核认证、商品化、支付分成、供应链管理、后台管理和移动端支持"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 用户注册与身份认证 (Priority: P1)

创作者和客户可以通过邮箱注册账户，完成身份验证，并根据角色获得相应的平台访问权限。

**Why this priority**: 身份认证是整个平台的基础，没有用户系统就无法实现后续的所有功能。

**Independent Test**: 可以通过注册新账户、邮箱验证、登录和权限检查来独立测试，提供基础的用户管理价值。

**Acceptance Scenarios**:

1. **Given** 用户访问注册页面, **When** 输入有效邮箱和密码并提交, **Then** 系统发送验证邮件并创建待激活账户
2. **Given** 用户收到验证邮件, **When** 点击验证链接, **Then** 账户激活成功并自动登录
3. **Given** 已注册用户, **When** 使用正确凭据登录, **Then** 根据用户角色跳转到相应界面
4. **Given** 用户忘记密码, **When** 使用找回密码功能, **Then** 收到重置邮件并可成功重置密码

---

### User Story 2 - 创作者方案提交系统 (Priority: P1)

创作者可以提交无人机解决方案，包括技术文档、BOM清单和设计文件，进入平台审核流程。

**Why this priority**: 这是平台内容生产的核心功能，是商业闭环的起点。

**Independent Test**: 可以通过创建方案、上传文件、保存草稿和提交审核来独立测试，提供内容创作价值。

**Acceptance Scenarios**:

1. **Given** 创作者已登录, **When** 创建新方案并填写基本信息, **Then** 系统保存为草稿状态
2. **Given** 创作者在编辑方案, **When** 上传PDF、CAD、CSV等技术文件, **Then** 文件成功存储并关联到方案
3. **Given** 方案信息完整, **When** 创作者提交审核, **Then** 方案状态变更为"待审核"并通知管理员
4. **Given** 方案处于草稿状态, **When** 创作者修改内容, **Then** 系统自动保存更改

---

### User Story 3 - 管理员审核工作流 (Priority: P1)

管理员可以查看待审核方案，进行专业评估，并做出通过、打回或拒绝的决定。

**Why this priority**: 审核是确保平台内容质量的关键环节，直接影响平台信誉。

**Independent Test**: 可以通过查看审核队列、评估方案、记录审核意见和更新状态来独立测试，提供内容质量控制价值。

**Acceptance Scenarios**:

1. **Given** 管理员登录后台, **When** 查看审核队列, **Then** 显示所有待审核方案的列表和基本信息
2. **Given** 管理员查看具体方案, **When** 审核通过并添加评语, **Then** 方案状态更新为"已通过"并通知创作者
3. **Given** 方案存在问题, **When** 管理员打回并说明原因, **Then** 方案状态变为"需修改"并发送修改建议给创作者
4. **Given** 方案不符合标准, **When** 管理员拒绝申请, **Then** 方案状态变为"已拒绝"并记录拒绝原因

---

### User Story 4 - 商品化系统 (Priority: P2)

通过审核的方案可以转化为商品，设置价格、库存等信息，并在平台商城中展示销售。

**Why this priority**: 商品化是实现收益的必要步骤，但依赖于前面的审核流程。

**Independent Test**: 可以通过创建商品、设置信息、上架展示和搜索浏览来独立测试，提供商品展示价值。

**Acceptance Scenarios**:

1. **Given** 方案审核通过, **When** 管理员创建对应商品, **Then** 系统生成商品草稿并关联原方案
2. **Given** 商品信息完整, **When** 设置价格和库存后上架, **Then** 商品在商城中可见并可被搜索
3. **Given** 商品已上架, **When** 客户浏览商品页面, **Then** 显示详细信息、价格和购买选项
4. **Given** 需要调整商品, **When** 管理员修改信息或下架, **Then** 商品状态和信息实时更新

---

### User Story 5 - 支付与收益分成 (Priority: P2)

客户可以购买商品并完成支付，系统自动按比例分配收益给创作者和平台。

**Why this priority**: 支付是商业闭环的核心，但需要先有商品才能实现。

**Independent Test**: 可以通过模拟购买、处理支付、计算分成和记录交易来独立测试，提供交易处理价值。

**Acceptance Scenarios**:

1. **Given** 客户选择商品, **When** 点击购买并完成支付, **Then** 订单创建成功并扣除库存
2. **Given** 支付成功, **When** 系统处理收益分成, **Then** 平台抽取5%，创作者获得95%收益
3. **Given** 创作者有收益, **When** 申请提现, **Then** 系统验证信息并处理打款
4. **Given** 支付失败, **When** 系统检测到异常, **Then** 回滚订单并通知用户重试

---

### User Story 6 - 供应链打样支持 (Priority: P3)

管理员可以将优质方案提交给合作工厂进行打样试产，跟踪生产状态。

**Why this priority**: 打样支持是增值服务，可以提升平台价值但不是核心闭环必需。

**Independent Test**: 可以通过创建打样订单、分配工厂、跟踪状态和管理交付来独立测试，提供供应链管理价值。

**Acceptance Scenarios**:

1. **Given** 管理员选择优质方案, **When** 创建打样订单并分配工厂, **Then** 工厂收到生产任务通知
2. **Given** 打样订单创建, **When** 工厂更新生产状态, **Then** 系统记录进度并通知相关人员
3. **Given** 打样完成, **When** 工厂标记为已交付, **Then** 系统生成交付报告并归档文件

---

### User Story 7 - 管理后台与数据分析 (Priority: P3)

管理员可以查看平台运营数据，包括用户活跃度、收入统计、审核通过率等关键指标。

**Why this priority**: 数据分析有助于运营优化，但不影响基础业务流程。

**Independent Test**: 可以通过查看仪表盘、生成报表、导出数据和分析趋势来独立测试，提供运营洞察价值。

**Acceptance Scenarios**:

1. **Given** 管理员访问仪表盘, **When** 查看关键指标, **Then** 显示实时的DAU、收入、通过率等数据
2. **Given** 需要详细分析, **When** 生成特定时间段报表, **Then** 系统导出CSV或PDF格式的数据报告
3. **Given** 发现异常数据, **When** 查看审计日志, **Then** 显示相关操作记录和责任人信息

---

### User Story 8 - 移动端支持 (Priority: P3)

用户可以在移动设备上浏览商品、查看审核状态、接收通知等，获得完整的移动体验。

**Why this priority**: 移动端支持提升用户体验，但桌面端已能满足基本需求。

**Independent Test**: 可以通过移动端浏览、PWA安装、推送通知和响应式交互来独立测试，提供移动体验价值。

**Acceptance Scenarios**:

1. **Given** 用户使用移动设备, **When** 访问平台网站, **Then** 界面自动适配移动端显示
2. **Given** 用户安装PWA, **When** 添加到主屏幕, **Then** 可以像原生应用一样启动和使用
3. **Given** 有重要更新, **When** 系统发送推送通知, **Then** 用户及时收到审核结果或订单状态通知

---

### Edge Cases

- 当用户上传超大文件（>100MB）时，系统如何处理存储和传输？
- 如何处理支付过程中的网络中断或第三方服务异常？
- 当创作者账户被封禁时，其已上架商品和待分成收益如何处理？
- 如何防止恶意用户批量注册或提交垃圾方案？
- 当工厂无法按时完成打样时，如何调整订单和通知相关方？

## Technical Specifications *(clarified)*

### Architecture Decisions

基于澄清过程确定的关键技术决策：

**支付系统架构**:
- 采用支付宝/微信支付集成，自建收益分成系统
- 理由：符合中国用户支付习惯，可控的收益分配机制
- 实现：集成支付宝SDK和微信支付API，自建分成计算和结算系统

**文件存储策略**:
- 采用本地服务器存储，直接文件系统管理
- 理由：数据安全可控，成本可预测，符合项目规模
- 实现：使用Node.js文件系统API，建立分类目录结构

**审核工作流状态管理**:
- 采用线性状态机：草稿 → 待审核 → 通过/拒绝/需修改
- 理由：简单清晰，易于维护，通过数据库锁处理并发
- 实现：使用枚举状态字段，事务确保状态转换原子性

**数据库并发控制**:
- 采用乐观锁+版本控制，事务冲突时重试
- 理由：平衡数据一致性和性能，适合Web应用场景
- 实现：添加version字段，更新时检查版本号，冲突时重试

**移动端PWA实现**:
- 采用基础PWA功能
- 理由：满足移动端访问需求，重点保证核心业务功能稳定性
- 实现：Service Worker缓存，Web App Manifest，基础离线支持

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: 系统必须支持邮箱注册、验证、登录和密码重置功能
- **FR-002**: 系统必须实现基于角色的访问控制，支持访客、创作者、管理员三种角色
- **FR-003**: 创作者必须能够创建、编辑、保存和提交无人机解决方案
- **FR-004**: 系统必须支持多种文件格式上传（PDF、CAD、CSV、ZIP等），采用本地文件系统存储
- **FR-005**: 管理员必须能够查看、审核、通过或拒绝创作者提交的方案
- **FR-006**: 系统必须记录完整的审核历史和操作日志
- **FR-007**: 审核通过的方案必须能够转化为可销售商品
- **FR-008**: 系统必须支持商品信息管理（名称、价格、库存、描述等）
- **FR-009**: 客户必须能够浏览、搜索和购买商品
- **FR-010**: 系统必须集成支付宝和微信支付处理在线支付
- **FR-011**: 系统必须自动计算和分配收益（平台5%，创作者95%），支持自建分成系统
- **FR-012**: 创作者必须能够查看收益明细和申请提现
- **FR-013**: 管理员必须能够管理工厂信息和创建打样订单
- **FR-014**: 系统必须跟踪打样订单的生产状态
- **FR-015**: 管理员必须能够查看平台运营数据和生成报表
- **FR-016**: 系统必须支持移动端响应式设计
- **FR-017**: 系统必须支持基础PWA功能和推送通知
- **FR-018**: 系统必须实现数据备份和安全防护机制，包含乐观锁并发控制

### Key Entities

- **User**: 用户实体，包含邮箱、密码哈希、角色、个人资料等属性
- **Solution**: 解决方案实体，包含标题、描述、状态（草稿/待审核/通过/拒绝/需修改）、版本、创作者等信息
- **Asset**: 附件实体，关联解决方案，存储文件路径、类型、大小等信息
- **Product**: 商品实体，与解决方案一对一关联，包含价格、库存、上架状态等
- **Order**: 订单实体，记录购买信息、支付状态、客户信息等
- **Payment**: 支付实体，记录支付方式（支付宝/微信支付）、金额、状态、第三方交易ID等
- **Revenue**: 收益实体，记录分成明细、提现状态、创作者收益等
- **ReviewLog**: 审核记录实体，记录审核人、时间、结果、评语等
- **Factory**: 工厂实体，包含名称、联系方式、地址、专业领域等
- **SampleOrder**: 打样订单实体，关联解决方案和工厂，跟踪生产状态
- **AuditLog**: 审计日志实体，记录所有重要操作的时间、用户、动作等

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 用户可以在2分钟内完成注册和邮箱验证流程
- **SC-002**: 创作者可以在15分钟内完成一个完整方案的提交
- **SC-003**: 管理员可以在5分钟内完成一个方案的审核决定
- **SC-004**: 客户可以在3分钟内完成商品购买和支付流程
- **SC-005**: 系统支持1000个并发用户同时访问而不出现性能下降
- **SC-006**: 支付成功率达到99.5%以上
- **SC-007**: 收益分成计算准确率达到100%
- **SC-008**: 移动端页面加载时间不超过3秒
- **SC-009**: 文件上传成功率达到98%以上
- **SC-010**: 用户首次使用时90%能够成功完成主要任务
- **SC-011**: 平台月活跃用户数相比当前增长50%
- **SC-012**: 创作者方案审核通过率稳定在70%以上
