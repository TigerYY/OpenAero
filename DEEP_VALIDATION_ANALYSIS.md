# æ·±åº¦éªŒè¯åˆ†ææŠ¥å‘Š

## ğŸ” ä¸ºä»€ä¹ˆç³»ç»Ÿæ€§ä¿®å¤æ²¡æœ‰å‘ç°é¦–é¡µé”™è¯¯ï¼Ÿ

### æ ¹æœ¬åŸå› 

#### 1. **é™æ€åˆ†æ vs è¿è¡Œæ—¶éªŒè¯çš„é¸¿æ²Ÿ**

**ä¹‹å‰çš„å·¥å…· (`diagnose-routes.ts`)**:
```typescript
// âŒ åªæ£€æŸ¥äº†å­—ç¬¦ä¸²æ¨¡å¼
const hasHardcodedRoute = /href=["']\/[a-z]/.test(content);
```

**é—®é¢˜**:
- âœ… èƒ½å‘ç°: `href="/login"` (ç¡¬ç¼–ç å­—ç¬¦ä¸²)
- âŒ ä¸èƒ½å‘ç°: `href={route('/login')}` ä½† `route` æœªå®šä¹‰
- âŒ ä¸èƒ½å‘ç°: æœåŠ¡ç«¯ç»„ä»¶ä½¿ç”¨ `useRouting`
- âŒ ä¸èƒ½å‘ç°: å®¢æˆ·ç«¯ç»„ä»¶ç¼ºå°‘ `const { route } = useRouting()`

#### 2. **è‡ªåŠ¨ä¿®å¤çš„ç›²ç›®æ€§**

**ä¿®å¤è„šæœ¬çš„é€»è¾‘**:
```typescript
// âŒ æœºæ¢°åœ°æ·»åŠ å¯¼å…¥ï¼Œä¸åˆ¤æ–­ç»„ä»¶ç±»å‹
if (hasHardcodedRoutes) {
  addImport("import { useRouting } from '@/lib/routing';");
}
```

**å¯¼è‡´çš„é—®é¢˜**:
- åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­æ·»åŠ äº† `useRouting` å¯¼å…¥
- æ·»åŠ äº†å¯¼å…¥ä½†æ²¡æœ‰æ·»åŠ  `const { route } = useRouting()` è°ƒç”¨
- æ²¡æœ‰æ£€æŸ¥æ˜¯å¦æœ‰ `'use client'` æŒ‡ä»¤

#### 3. **æµ‹è¯•ç­–ç•¥çš„ç¼ºå¤±**

**ä¿®å¤ååªåšäº†**:
- âœ… ç»Ÿè®¡ç¡¬ç¼–ç è·¯ç”±æ•°é‡ = 0
- âœ… ç”ŸæˆJSONæŠ¥å‘Š

**æ²¡æœ‰åš**:
- âŒ å¯åŠ¨å¼€å‘æœåŠ¡å™¨
- âŒ HTTPè¯·æ±‚æµ‹è¯•
- âŒ æ„å»ºæ—¶æ£€æŸ¥ (`npm run build`)
- âŒ TypeScriptç±»å‹æ£€æŸ¥

---

## ğŸ“Š æ·±åº¦éªŒè¯å‘ç°çš„38ä¸ªé—®é¢˜

### é—®é¢˜åˆ†ç±»

| ç±»åˆ« | æ•°é‡ | ä¸¥é‡ç¨‹åº¦ | å½±å“ |
|------|------|----------|------|
| æœåŠ¡ç«¯ç»„ä»¶ä½¿ç”¨ useRouting | 3 | ğŸ”´ Critical | è¿è¡Œæ—¶æŠ¥é”™ 500 |
| ä½¿ç”¨ route() ä½†æœªå£°æ˜ | 33 | ğŸ”´ Critical | `route is not defined` |
| åŠ¨æ€è·¯ç”±åœ¨æœåŠ¡ç«¯ç»„ä»¶ | 2 | ğŸ”´ Critical | æ— æ³•æ¸²æŸ“ |
| ç¡¬ç¼–ç è·¯ç”±ï¼ˆå¾…ç¡®è®¤ï¼‰ | 4 | â„¹ï¸ Info | å¯èƒ½æ˜¯åˆæ³•ç”¨ä¾‹ |

### å…¸å‹æ¡ˆä¾‹

#### Case 1: æœåŠ¡ç«¯ç»„ä»¶é”™è¯¯
```typescript
// âŒ src/components/ui/Logo.tsx
import { useRouting } from '@/lib/routing'; // æœåŠ¡ç«¯ç»„ä»¶ä¸èƒ½ç”¨

export default function Logo() {
  const { route } = useRouting(); // ğŸ’¥ è¿è¡Œæ—¶é”™è¯¯
  return <Link href={route('/')}>Logo</Link>;
}
```

#### Case 2: ç¼ºå°‘å£°æ˜
```typescript
// âŒ src/components/shop/CartDrawer.tsx
'use client';
import { useRouting } from '@/lib/routing'; // âœ… å¯¼å…¥äº†

export default function CartDrawer() {
  // âŒ ä½†æ²¡æœ‰è°ƒç”¨ï¼
  return <Link href={route('/shop')}>{/* ğŸ’¥ route is not defined */}</Link>;
}
```

#### Case 3: æ‰¹é‡å‘ç”Ÿåœ¨å¤šä¸ªé¡µé¢
```typescript
// âŒ 33ä¸ªæ–‡ä»¶éƒ½æœ‰è¿™ä¸ªé—®é¢˜
// src/app/[locale]/(auth)/login/page.tsx
// src/app/[locale]/(auth)/register/page.tsx
// src/app/solutions/[id]/page.tsx
// src/app/creators/dashboard/page.tsx
// ... æ›´å¤š
```

---

## ğŸ¯ æ”¹è¿›æ–¹æ¡ˆ

### 1. å¢å¼ºè¯Šæ–­å·¥å…·

**æ–°å·¥å…·åº”è¯¥æ£€æµ‹**:
- [ ] æœåŠ¡ç«¯ç»„ä»¶ vs å®¢æˆ·ç«¯ç»„ä»¶åŒºåˆ†
- [ ] `useRouting` å¯¼å…¥ä½†æœªè°ƒç”¨
- [ ] `route()` ä½¿ç”¨ä½†æœªå£°æ˜
- [ ] åŠ¨æ€è·¯ç”±åœ¨æœåŠ¡ç«¯ç»„ä»¶ä¸­çš„ä½¿ç”¨
- [ ] TypeScriptç±»å‹é”™è¯¯
- [ ] æ„å»ºæ—¶é”™è¯¯

### 2. è¿è¡Œæ—¶æµ‹è¯•

**å¿…é¡»åŒ…æ‹¬**:
```bash
# ç±»å‹æ£€æŸ¥
npm run type-check

# æ„å»ºæµ‹è¯•
npm run build

# å¯åŠ¨å¹¶æµ‹è¯•å…³é”®è·¯ç”±
npm run dev &
curl http://localhost:3000/
curl http://localhost:3000/zh-CN
curl http://localhost:3000/zh-CN/login
```

### 3. åˆ†å±‚ä¿®å¤ç­–ç•¥

**Phase 1: è‡ªåŠ¨ä¿®å¤å®‰å…¨é¡¹**
- çº¯å­—ç¬¦ä¸²ç¡¬ç¼–ç  â†’ `route()` åŒ…è£…

**Phase 2: æ‰‹åŠ¨å®¡æŸ¥å¤æ‚é¡¹**
- æœåŠ¡ç«¯ç»„ä»¶ â†’ è½¬ä¸ºå®¢æˆ·ç«¯æˆ–ä½¿ç”¨ Link
- ç¼ºå°‘å£°æ˜ â†’ æ·»åŠ  `const { route } = useRouting()`

**Phase 3: éªŒè¯**
- HTTPæµ‹è¯•
- æ„å»ºæµ‹è¯•
- E2Eæµ‹è¯•

---

## ğŸ“ˆ å·¥å…·å¯¹æ¯”

| æ£€æµ‹é¡¹ | diagnose-routes.ts | deep-route-validation.ts | ç†æƒ³å·¥å…· |
|--------|-------------------|-------------------------|----------|
| ç¡¬ç¼–ç å­—ç¬¦ä¸² | âœ… | âœ… | âœ… |
| æœåŠ¡ç«¯ç»„ä»¶åŒºåˆ† | âŒ | âœ… | âœ… |
| å˜é‡å£°æ˜æ£€æŸ¥ | âŒ | âœ… | âœ… |
| è¿è¡Œæ—¶æµ‹è¯• | âŒ | âŒ | âœ… |
| TypeScriptæ£€æŸ¥ | âŒ | âŒ | âœ… |
| è‡ªåŠ¨ä¿®å¤ | âœ… (ç›²ç›®) | âŒ | âœ… (æ™ºèƒ½) |

---

## ğŸš€ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³ä¿®å¤ (38ä¸ªä¸¥é‡é—®é¢˜)

1. **æœåŠ¡ç«¯ç»„ä»¶é—®é¢˜** (3ä¸ª)
   - `Logo.tsx` â†’ è½¬ä¸ºå®¢æˆ·ç«¯ç»„ä»¶
   - `ServerHeader.tsx` â†’ ä½¿ç”¨ Link è€Œä¸æ˜¯ route()

2. **ç¼ºå°‘å£°æ˜é—®é¢˜** (33ä¸ª)
   - æ‰¹é‡æ·»åŠ  `const { route } = useRouting()`
   - åˆ†ç»„å¤„ç†:
     - Authé¡µé¢ (3ä¸ª)
     - Businessé¡µé¢ (15ä¸ª)
     - Component (10ä¸ª)
     - Others (5ä¸ª)

3. **åŠ¨æ€è·¯ç”±é—®é¢˜** (2ä¸ª)
   - æ£€æŸ¥æ˜¯å¦éœ€è¦æœåŠ¡ç«¯æ¸²æŸ“
   - è€ƒè™‘è½¬ä¸ºå®¢æˆ·ç«¯ç»„ä»¶

### é•¿æœŸæ”¹è¿›

- [ ] é›†æˆåˆ° CI/CD (`deep-route-validation.ts`)
- [ ] æ·»åŠ pre-commit hook
- [ ] åˆ›å»ºESLintè§„åˆ™æ£€æµ‹è¿™äº›æ¨¡å¼
- [ ] å»ºç«‹è‡ªåŠ¨åŒ–æµ‹è¯•è¦†ç›–æ‰€æœ‰è·¯ç”±

---

## ğŸ’¡ ç»éªŒæ•™è®­

1. **é™æ€åˆ†æä¸è¶³å¤Ÿ** - å¿…é¡»ç»“åˆè¿è¡Œæ—¶æµ‹è¯•
2. **è‡ªåŠ¨åŒ–è¦æ™ºèƒ½** - ä¸èƒ½ç›²ç›®ä¿®æ”¹ä»£ç 
3. **æµ‹è¯•è¦åˆ†å±‚** - é™æ€ â†’ æ„å»º â†’ è¿è¡Œæ—¶ â†’ E2E
4. **å·¥å…·è¦è¿›åŒ–** - ä»ç®€å•æ¨¡å¼åŒ¹é…åˆ°ASTæ·±åº¦åˆ†æ

---

ç”Ÿæˆæ—¶é—´: 2025-11-12
å·¥å…·ç‰ˆæœ¬: deep-route-validation v1.0
