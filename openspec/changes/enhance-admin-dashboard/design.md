## Context

管理中心仪表板是管理员日常工作的核心界面，需要提供：
- 快速了解平台整体运营状况
- 及时发现和处理异常情况
- 高效执行批量操作
- 深入分析数据趋势

当前实现已有基础功能，但缺少数据可视化和实时监控能力。

## Goals / Non-Goals

### Goals
- 提供直观的数据可视化，帮助管理员快速理解趋势
- 实现实时活动监控，及时发现问题
- 增强数据导出能力，支持多种格式和筛选
- 添加预警机制，主动提醒关键指标异常
- 优化性能和用户体验

### Non-Goals
- 不实现复杂的自定义报表构建器（后续版本考虑）
- 不实现实时协作功能（多人同时操作）
- 不实现数据预测和AI分析（后续版本考虑）

## Decisions

### 1. 图表库选择
**Decision**: 使用 `recharts` 作为主要图表库
**Rationale**: 
- 基于React，与项目技术栈一致
- 轻量级，性能好
- 支持响应式设计
- 社区活跃，文档完善

**Alternatives considered**:
- Chart.js: 功能强大但体积较大
- Victory: 配置复杂
- D3.js: 过于底层，开发成本高

### 2. 数据导出格式
**Decision**: 支持JSON、CSV、Excel三种格式
**Rationale**:
- JSON: 程序化处理，适合API集成
- CSV: 通用格式，适合数据分析工具
- Excel: 用户友好，适合非技术用户

**Implementation**: 使用 `xlsx` 库生成Excel文件

### 3. 实时更新机制
**Decision**: 使用轮询方式（初始版本），后续可升级为WebSocket
**Rationale**:
- 实现简单，无需额外基础设施
- 足够满足当前需求（30秒刷新间隔）
- 后续可平滑升级到WebSocket

**Future**: 当需要真正的实时性时，使用WebSocket或Server-Sent Events

### 4. 缓存策略
**Decision**: 使用内存缓存（Node.js Map），缓存时间5-10分钟
**Rationale**:
- 简单有效，无需额外依赖
- 统计数据变化不频繁，缓存有效
- 后续可升级到Redis（如需要分布式缓存）

### 5. 预警规则
**Decision**: 硬编码预警规则（初始版本），后续可配置化
**Rationale**:
- 快速实现，满足基本需求
- 规则相对固定，配置化优先级低
- 后续版本可添加规则配置界面

**Warning Rules**:
- 待审核方案 > 50: 警告级别
- 待审核方案 > 100: 严重级别
- 用户增长 < -10%: 警告级别
- 审核时间 > 48小时: 警告级别

## Risks / Trade-offs

### 风险1: 大数据量性能问题
**风险**: 当数据量很大时，统计查询和图表渲染可能变慢
**缓解措施**:
- 添加数据库索引
- 使用缓存减少查询
- 分页加载图表数据
- 考虑数据归档策略

### 风险2: 实时更新频率
**风险**: 轮询频率过高会增加服务器负载
**缓解措施**:
- 使用合理的刷新间隔（30秒）
- 实现智能刷新（仅在页面可见时刷新）
- 提供手动刷新选项

### 风险3: 浏览器兼容性
**风险**: 图表库可能不支持旧版浏览器
**缓解措施**:
- 使用现代浏览器支持的库
- 提供降级方案（表格展示）
- 明确浏览器支持要求

## Migration Plan

### 阶段1: 后端增强（1-2天）
1. 实现平均审核时间计算
2. 添加图表数据API
3. 增强导出功能

### 阶段2: 前端组件（2-3天）
1. 创建图表组件
2. 创建活动流组件
3. 创建预警组件

### 阶段3: 集成和优化（1-2天）
1. 集成到仪表板页面
2. 性能优化
3. 测试和修复

### 回滚计划
- 所有新功能都是增量添加，不影响现有功能
- 如果出现问题，可以快速禁用新功能
- 保持向后兼容的API接口

## Open Questions

1. **图表数据粒度**: 时间序列数据应该按天、按周还是按月聚合？
   - 建议：默认按天，提供切换选项

2. **活动流保留时间**: 活动记录应该保留多长时间？
   - 建议：保留最近30天，更早的数据归档

3. **预警通知方式**: 除了页面显示，是否需要邮件或推送通知？
   - 建议：初始版本仅页面显示，后续添加通知

4. **导出数据限制**: 单次导出是否有数据量限制？
   - 建议：限制10,000条，超过需要分批导出

