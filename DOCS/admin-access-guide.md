# ç®¡ç†å‘˜ç™»å½•å…¥å£å’Œç®¡ç†é¡µé¢æŒ‡å—

## ğŸ“‹ ç›®å½•
1. [ç®¡ç†å‘˜ç™»å½•å…¥å£](#ç®¡ç†å‘˜ç™»å½•å…¥å£)
2. [ç®¡ç†å‘˜é¡µé¢åˆ—è¡¨](#ç®¡ç†å‘˜é¡µé¢åˆ—è¡¨)
3. [è®¿é—®æ–¹å¼](#è®¿é—®æ–¹å¼)
4. [æƒé™ä¿æŠ¤](#æƒé™ä¿æŠ¤)
5. [ç®¡ç†å‘˜åŠŸèƒ½æ¦‚è§ˆ](#ç®¡ç†å‘˜åŠŸèƒ½æ¦‚è§ˆ)

---

## 1. ç®¡ç†å‘˜ç™»å½•å…¥å£

### 1.1 ç™»å½•é¡µé¢
**URL**: `/{locale}/login`  
**ç¤ºä¾‹**: `http://localhost:3000/zh-CN/login` æˆ– `http://localhost:3000/en-US/login`

**è¯´æ˜**ï¼š
- âœ… ç®¡ç†å‘˜å’Œæ™®é€šç”¨æˆ·ä½¿ç”¨**åŒä¸€ä¸ªç™»å½•é¡µé¢**
- âœ… ç™»å½•åç³»ç»Ÿä¼šæ ¹æ®ç”¨æˆ·è§’è‰²è‡ªåŠ¨æ˜¾ç¤ºç›¸åº”çš„èœå•
- âœ… ç®¡ç†å‘˜ç™»å½•åä¼šåœ¨ç”¨æˆ·èœå•ä¸­çœ‹åˆ°"ç®¡ç†å‘˜ä»ªè¡¨ç›˜"é€‰é¡¹

### 1.2 ç™»å½•æµç¨‹
```
1. è®¿é—® /login é¡µé¢
   â†“
2. è¾“å…¥ç®¡ç†å‘˜é‚®ç®±å’Œå¯†ç 
   â†“
3. ç‚¹å‡»"ç™»å½•"æŒ‰é’®
   â†“
4. ç³»ç»ŸéªŒè¯ç”¨æˆ·èº«ä»½
   â†“
5. æ£€æŸ¥ç”¨æˆ·è§’è‰²ï¼ˆå¿…é¡»æ˜¯ ADMIN æˆ– SUPER_ADMINï¼‰
   â†“
6. ç™»å½•æˆåŠŸï¼Œæ˜¾ç¤ºç®¡ç†å‘˜èœå•
```

---

## 2. ç®¡ç†å‘˜é¡µé¢åˆ—è¡¨

### 2.1 ç®¡ç†å‘˜ä»ªè¡¨ç›˜
**URL**: `/{locale}/admin/dashboard`  
**æ–‡ä»¶**: `src/app/[locale]/admin/dashboard/page.tsx`  
**åŠŸèƒ½**ï¼š
- å¹³å°æ¦‚è§ˆç»Ÿè®¡
- å¿«é€Ÿæ“ä½œ
- æ•°æ®å¯è§†åŒ–
- æ—¶é—´èŒƒå›´ç­›é€‰

### 2.2 ç”¨æˆ·ç®¡ç†
**URL**: `/{locale}/admin/users`  
**æ–‡ä»¶**: `src/app/[locale]/admin/users/page.tsx`  
**åŠŸèƒ½**ï¼š
- ç”¨æˆ·åˆ—è¡¨æŸ¥çœ‹
- ç”¨æˆ·æœç´¢å’Œç­›é€‰
- ç”¨æˆ·è¯¦æƒ…æŸ¥çœ‹
- ä¿®æ”¹ç”¨æˆ·çŠ¶æ€
- ä¿®æ”¹ç”¨æˆ·è§’è‰²
- æ‰¹é‡æ“ä½œ

### 2.3 æ–¹æ¡ˆç®¡ç†
**URL**: `/{locale}/admin/solutions`  
**æ–‡ä»¶**: `src/app/[locale]/admin/solutions/page.tsx`  
**åŠŸèƒ½**ï¼š
- æ–¹æ¡ˆåˆ—è¡¨æŸ¥çœ‹
- æ–¹æ¡ˆå®¡æ ¸
- æ–¹æ¡ˆçŠ¶æ€ç®¡ç†

### 2.4 å®¡æ ¸å·¥ä½œå°
**URL**: `/{locale}/admin/review-workbench`  
**æ–‡ä»¶**: `src/app/[locale]/admin/review-workbench/page.tsx`  
**åŠŸèƒ½**ï¼š
- å¾…å®¡æ ¸æ–¹æ¡ˆåˆ—è¡¨
- æ–¹æ¡ˆå®¡æ ¸æ“ä½œ
- å®¡æ ¸å†å²è®°å½•

### 2.5 å®¡æ ¸ç»Ÿè®¡
**URL**: `/{locale}/admin/review-stats`  
**æ–‡ä»¶**: `src/app/[locale]/admin/review-stats/page.tsx`  
**åŠŸèƒ½**ï¼š
- å®¡æ ¸æ•°æ®ç»Ÿè®¡
- å®¡æ ¸æ•ˆç‡åˆ†æ

### 2.6 äº§å“ç®¡ç†
**URL**: `/{locale}/admin/products`  
**æ–‡ä»¶**: `src/app/[locale]/admin/products/page.tsx`  
**åŠŸèƒ½**ï¼š
- äº§å“åˆ—è¡¨ç®¡ç†
- äº§å“å®¡æ ¸
- äº§å“çŠ¶æ€ç®¡ç†

### 2.7 ç³»ç»Ÿç›‘æ§
**URL**: `/{locale}/admin/monitoring`  
**æ–‡ä»¶**: `src/app/[locale]/admin/monitoring/page.tsx`  
**åŠŸèƒ½**ï¼š
- ç³»ç»Ÿæ€§èƒ½ç›‘æ§
- é”™è¯¯è¿½è¸ª
- è¯·æ±‚ç»Ÿè®¡
- æ•°æ®åº“æŸ¥è¯¢ç›‘æ§

### 2.8 å®¡è®¡æ—¥å¿—
**URL**: `/{locale}/admin/audit-logs`  
**æ–‡ä»¶**: `src/app/[locale]/admin/audit-logs/page.tsx`  
**åŠŸèƒ½**ï¼š
- æŸ¥çœ‹æ‰€æœ‰æ“ä½œæ—¥å¿—
- æ—¥å¿—æœç´¢å’Œç­›é€‰
- æ—¥å¿—ç»Ÿè®¡åˆ†æ

### 2.9 æ•°æ®åˆ†æ
**URL**: `/{locale}/admin/analytics`  
**æ–‡ä»¶**: `src/app/[locale]/admin/analytics/page.tsx`  
**åŠŸèƒ½**ï¼š
- å¹³å°æ•°æ®åˆ†æ
- ç”¨æˆ·è¡Œä¸ºåˆ†æ
- ä¸šåŠ¡æŒ‡æ ‡ç»Ÿè®¡

### 2.10 æƒé™ç®¡ç†
**URL**: `/{locale}/admin/permissions`  
**æ–‡ä»¶**: `src/app/[locale]/admin/permissions/page.tsx`  
**åŠŸèƒ½**ï¼š
- è§’è‰²æƒé™é…ç½®
- ç”¨æˆ·æƒé™ç®¡ç†

---

## 3. è®¿é—®æ–¹å¼

### 3.1 é€šè¿‡ç”¨æˆ·èœå•è®¿é—®ï¼ˆæ¨èï¼‰
1. **ç™»å½•ç³»ç»Ÿ**ï¼ˆä½¿ç”¨ç®¡ç†å‘˜è´¦å·ï¼‰
2. **ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å¤´åƒ**ï¼Œæ‰“å¼€ç”¨æˆ·èœå•
3. **ç‚¹å‡»"ç®¡ç†å‘˜ä»ªè¡¨ç›˜"**èœå•é¡¹
4. è¿›å…¥ç®¡ç†å‘˜ä»ªè¡¨ç›˜é¡µé¢

**èœå•ä½ç½®**ï¼š
```
Header (å³ä¸Šè§’)
  â””â”€ UserMenu (ç”¨æˆ·å¤´åƒ)
      â””â”€ ç®¡ç†å‘˜ä»ªè¡¨ç›˜ (ä»…ç®¡ç†å‘˜å¯è§)
```

### 3.2 ç›´æ¥è®¿é—® URL
ç®¡ç†å‘˜å¯ä»¥ç›´æ¥è®¿é—®ä»¥ä¸‹ URLï¼š

**ä¸­æ–‡**ï¼š
- `http://localhost:3000/zh-CN/admin/dashboard` - ç®¡ç†å‘˜ä»ªè¡¨ç›˜
- `http://localhost:3000/zh-CN/admin/users` - ç”¨æˆ·ç®¡ç†
- `http://localhost:3000/zh-CN/admin/solutions` - æ–¹æ¡ˆç®¡ç†
- `http://localhost:3000/zh-CN/admin/monitoring` - ç³»ç»Ÿç›‘æ§
- ç­‰ç­‰...

**è‹±æ–‡**ï¼š
- `http://localhost:3000/en-US/admin/dashboard` - Admin Dashboard
- `http://localhost:3000/en-US/admin/users` - User Management
- ç­‰ç­‰...

### 3.3 ä½¿ç”¨è·¯ç”±å·¥å…·
```typescript
import { useRouting } from '@/lib/routing';

const { route, routes } = useRouting();

// è®¿é—®ç®¡ç†å‘˜ä»ªè¡¨ç›˜
router.push(route(routes.ADMIN.DASHBOARD));

// è®¿é—®ç”¨æˆ·ç®¡ç†
router.push(route(routes.ADMIN.USERS));
```

---

## 4. æƒé™ä¿æŠ¤

### 4.1 è·¯ç”±ä¿æŠ¤
æ‰€æœ‰ç®¡ç†å‘˜é¡µé¢éƒ½ä½¿ç”¨ `AdminRoute` ç»„ä»¶è¿›è¡Œä¿æŠ¤ï¼š

```typescript
import { AdminRoute } from '@/components/auth/ProtectedRoute';

export default function AdminDashboard() {
  return (
    <AdminRoute>
      <DefaultLayout>
        {/* ç®¡ç†å‘˜é¡µé¢å†…å®¹ */}
      </DefaultLayout>
    </AdminRoute>
  );
}
```

### 4.2 æƒé™æ£€æŸ¥
- âœ… æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
- âœ… æ£€æŸ¥ç”¨æˆ·è§’è‰²æ˜¯å¦ä¸º `ADMIN` æˆ– `SUPER_ADMIN`
- âœ… éç®¡ç†å‘˜ç”¨æˆ·ä¼šè¢«é‡å®šå‘åˆ° `/unauthorized` é¡µé¢

### 4.3 API æƒé™æ£€æŸ¥
æ‰€æœ‰ç®¡ç†å‘˜ API è·¯ç”±éƒ½ä¼šæ£€æŸ¥æƒé™ï¼š

```typescript
// ç¤ºä¾‹ï¼šsrc/app/api/admin/users/route.ts
const user = await getServerUserFromRequest(request);
if (!user) {
  return createErrorResponse('æœªæˆæƒè®¿é—®', 401);
}

// æ£€æŸ¥ç®¡ç†å‘˜æƒé™
const extendedUser = await getServerExtendedUserFromRequest(request);
if (!extendedUser?.profile || 
    (extendedUser.profile.role !== 'ADMIN' && 
     extendedUser.profile.role !== 'SUPER_ADMIN')) {
  return createErrorResponse('æƒé™ä¸è¶³', 403);
}
```

---

## 5. ç®¡ç†å‘˜åŠŸèƒ½æ¦‚è§ˆ

### 5.1 ç”¨æˆ·ç®¡ç†åŠŸèƒ½ âœ…
- [x] ç”¨æˆ·åˆ—è¡¨æŸ¥çœ‹
- [x] ç”¨æˆ·æœç´¢å’Œç­›é€‰
- [x] ç”¨æˆ·è¯¦æƒ…æŸ¥çœ‹
- [x] ä¿®æ”¹ç”¨æˆ·çŠ¶æ€ï¼ˆACTIVE, INACTIVE, SUSPENDED, DELETEDï¼‰
- [x] ä¿®æ”¹ç”¨æˆ·è§’è‰²
- [x] æ‰¹é‡æ“ä½œï¼ˆå¾…å®Œå–„ï¼‰

### 5.2 æ–¹æ¡ˆç®¡ç†åŠŸèƒ½ âœ…
- [x] æ–¹æ¡ˆåˆ—è¡¨æŸ¥çœ‹
- [x] æ–¹æ¡ˆå®¡æ ¸
- [x] æ–¹æ¡ˆçŠ¶æ€ç®¡ç†

### 5.3 å®¡æ ¸åŠŸèƒ½ âœ…
- [x] å®¡æ ¸å·¥ä½œå°
- [x] å®¡æ ¸ç»Ÿè®¡
- [x] å®¡æ ¸å†å²è®°å½•

### 5.4 ç³»ç»Ÿç›‘æ§åŠŸèƒ½ âœ…
- [x] ç³»ç»Ÿæ€§èƒ½ç›‘æ§
- [x] é”™è¯¯è¿½è¸ª
- [x] è¯·æ±‚ç»Ÿè®¡
- [x] æ•°æ®åº“æŸ¥è¯¢ç›‘æ§

### 5.5 å®¡è®¡æ—¥å¿—åŠŸèƒ½ âœ…
- [x] æŸ¥çœ‹æ‰€æœ‰æ“ä½œæ—¥å¿—
- [x] æ—¥å¿—æœç´¢å’Œç­›é€‰
- [x] æ—¥å¿—ç»Ÿè®¡åˆ†æ

---

## 6. å¿«é€Ÿè®¿é—®é“¾æ¥

### å¼€å‘ç¯å¢ƒ
- **ç™»å½•é¡µé¢**: `http://localhost:3000/zh-CN/login`
- **ç®¡ç†å‘˜ä»ªè¡¨ç›˜**: `http://localhost:3000/zh-CN/admin/dashboard`
- **ç”¨æˆ·ç®¡ç†**: `http://localhost:3000/zh-CN/admin/users`
- **ç³»ç»Ÿç›‘æ§**: `http://localhost:3000/zh-CN/admin/monitoring`

### ç”Ÿäº§ç¯å¢ƒ
- **ç™»å½•é¡µé¢**: `https://your-domain.com/zh-CN/login`
- **ç®¡ç†å‘˜ä»ªè¡¨ç›˜**: `https://your-domain.com/zh-CN/admin/dashboard`
- ç­‰ç­‰...

---

## 7. åˆ›å»ºç®¡ç†å‘˜è´¦å·

### æ–¹æ³• 1: é€šè¿‡æ•°æ®åº“ç›´æ¥è®¾ç½®ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
```sql
-- 1. åœ¨ Supabase Dashboard åˆ›å»ºç”¨æˆ·ï¼ˆæˆ–ä½¿ç”¨ç°æœ‰ç”¨æˆ·ï¼‰
-- 2. æ›´æ–° user_profiles è¡¨çš„è§’è‰²
UPDATE user_profiles 
SET role = 'ADMIN' 
WHERE user_id = 'your-user-id';
```

### æ–¹æ³• 2: é€šè¿‡ç®¡ç†å‘˜ç•Œé¢ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
1. ä½¿ç”¨ç°æœ‰çš„ SUPER_ADMIN è´¦å·ç™»å½•
2. è¿›å…¥"ç”¨æˆ·ç®¡ç†"é¡µé¢
3. æ‰¾åˆ°ç›®æ ‡ç”¨æˆ·
4. ç‚¹å‡»"ç¼–è¾‘"ï¼Œä¿®æ”¹è§’è‰²ä¸º `ADMIN` æˆ– `SUPER_ADMIN`

---

## 8. ç›¸å…³æ–‡ä»¶

### 8.1 é¡µé¢æ–‡ä»¶
- `src/app/[locale]/admin/dashboard/page.tsx` - ç®¡ç†å‘˜ä»ªè¡¨ç›˜
- `src/app/[locale]/admin/users/page.tsx` - ç”¨æˆ·ç®¡ç†
- `src/app/[locale]/admin/solutions/page.tsx` - æ–¹æ¡ˆç®¡ç†
- `src/app/[locale]/admin/monitoring/page.tsx` - ç³»ç»Ÿç›‘æ§
- ç­‰ç­‰...

### 8.2 ç»„ä»¶æ–‡ä»¶
- `src/components/auth/UserMenu.tsx` - ç”¨æˆ·èœå•ï¼ˆåŒ…å«ç®¡ç†å‘˜å…¥å£ï¼‰
- `src/components/auth/ProtectedRoute.tsx` - è·¯ç”±ä¿æŠ¤ç»„ä»¶
- `src/components/admin/MonitoringDashboard.tsx` - ç›‘æ§ä»ªè¡¨ç›˜ç»„ä»¶

### 8.3 API è·¯ç”±
- `src/app/api/admin/users/route.ts` - ç”¨æˆ·ç®¡ç† API
- `src/app/api/admin/dashboard/stats/route.ts` - ä»ªè¡¨ç›˜ç»Ÿè®¡ API
- `src/app/api/admin/monitoring/route.ts` - ç›‘æ§æ•°æ® API
- ç­‰ç­‰...

---

## 9. æ³¨æ„äº‹é¡¹

### âš ï¸ å®‰å…¨æé†’
1. **ç®¡ç†å‘˜è´¦å·å®‰å…¨**ï¼š
   - ä½¿ç”¨å¼ºå¯†ç 
   - å®šæœŸæ›´æ¢å¯†ç 
   - ä¸è¦åœ¨å…¬å…±è®¾å¤‡ä¸Šç™»å½•

2. **æƒé™ç®¡ç†**ï¼š
   - åªæœ‰ SUPER_ADMIN å¯ä»¥åˆ›å»ºå…¶ä»–ç®¡ç†å‘˜
   - è°¨æ…åˆ†é…ç®¡ç†å‘˜æƒé™
   - å®šæœŸå®¡æŸ¥ç®¡ç†å‘˜åˆ—è¡¨

3. **æ“ä½œå®¡è®¡**ï¼š
   - æ‰€æœ‰ç®¡ç†å‘˜æ“ä½œéƒ½ä¼šè®°å½•åˆ°å®¡è®¡æ—¥å¿—
   - å®šæœŸæ£€æŸ¥å®¡è®¡æ—¥å¿—
   - å‘ç°å¼‚å¸¸æ“ä½œåŠæ—¶å¤„ç†

### ğŸ“ å¼€å‘æç¤º
1. **æµ‹è¯•ç®¡ç†å‘˜åŠŸèƒ½**ï¼š
   - åˆ›å»ºæµ‹è¯•ç®¡ç†å‘˜è´¦å·
   - ä½¿ç”¨æµ‹è¯•è´¦å·æµ‹è¯•æ‰€æœ‰åŠŸèƒ½

2. **æƒé™æ£€æŸ¥**ï¼š
   - ç¡®ä¿æ‰€æœ‰ç®¡ç†å‘˜é¡µé¢éƒ½æœ‰æƒé™ä¿æŠ¤
   - ç¡®ä¿æ‰€æœ‰ç®¡ç†å‘˜ API éƒ½æœ‰æƒé™æ£€æŸ¥

3. **é”™è¯¯å¤„ç†**ï¼š
   - éç®¡ç†å‘˜ç”¨æˆ·è®¿é—®ç®¡ç†å‘˜é¡µé¢åº”æ˜¾ç¤ºå‹å¥½é”™è¯¯
   - API åº”è¿”å›é€‚å½“çš„é”™è¯¯ç ï¼ˆ401/403ï¼‰

---

## 10. æ€»ç»“

### ç™»å½•å…¥å£
- âœ… **ç»Ÿä¸€ç™»å½•é¡µé¢**: `/{locale}/login`
- âœ… **è‡ªåŠ¨è¯†åˆ«è§’è‰²**: ç™»å½•åæ ¹æ®è§’è‰²æ˜¾ç¤ºèœå•

### é¡µé¢è®¿é—®
- âœ… **ç”¨æˆ·èœå•**: ç‚¹å‡»å³ä¸Šè§’ç”¨æˆ·å¤´åƒ â†’ "ç®¡ç†å‘˜ä»ªè¡¨ç›˜"
- âœ… **ç›´æ¥ URL**: `/{locale}/admin/dashboard`
- âœ… **è·¯ç”±å·¥å…·**: ä½¿ç”¨ `useRouting()` hook

### æƒé™ä¿æŠ¤
- âœ… **å‰ç«¯ä¿æŠ¤**: `AdminRoute` ç»„ä»¶
- âœ… **åç«¯ä¿æŠ¤**: API è·¯ç”±æƒé™æ£€æŸ¥
- âœ… **æ•°æ®åº“ä¿æŠ¤**: RLS ç­–ç•¥

### ç®¡ç†å‘˜é¡µé¢
- âœ… **ä»ªè¡¨ç›˜**: å¹³å°æ¦‚è§ˆå’Œå¿«é€Ÿæ“ä½œ
- âœ… **ç”¨æˆ·ç®¡ç†**: å®Œæ•´çš„ç”¨æˆ·ç®¡ç†åŠŸèƒ½
- âœ… **æ–¹æ¡ˆç®¡ç†**: æ–¹æ¡ˆå®¡æ ¸å’Œç®¡ç†
- âœ… **ç³»ç»Ÿç›‘æ§**: æ€§èƒ½ç›‘æ§å’Œé”™è¯¯è¿½è¸ª
- âœ… **å®¡è®¡æ—¥å¿—**: æ“ä½œæ—¥å¿—æŸ¥çœ‹å’Œåˆ†æ

