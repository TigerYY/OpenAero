<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenAero è®¤è¯ç³»ç»Ÿæµ‹è¯•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .test-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 1rem;
            margin-top: 1rem;
            border-radius: 0.375rem;
            font-family: monospace;
            font-size: 0.875rem;
        }
        .success { background-color: #d1fae5; color: #065f46; border-left: 4px solid #10b981; }
        .error { background-color: #fee2e2; color: #991b1b; border-left: 4px solid #ef4444; }
        .info { background-color: #dbeafe; color: #1e40af; border-left: 4px solid #3b82f6; }
    </style>
</head>
<body class="bg-gray-50">
    <div class="max-w-4xl mx-auto py-8 px-4">
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">OpenAero è®¤è¯ç³»ç»Ÿæµ‹è¯•é¡µé¢</h1>
            <p class="text-gray-600">æµ‹è¯•ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ç™»å‡ºç­‰åŠŸèƒ½</p>
        </div>

        <!-- é…ç½®æ£€æŸ¥ -->
        <div class="test-section">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <span class="mr-2">ğŸ”</span> ç³»ç»Ÿé…ç½®æ£€æŸ¥
            </h2>
            <button onclick="checkConfig()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                æ£€æŸ¥é…ç½®
            </button>
            <div id="config-result"></div>
        </div>

        <!-- UIç»„ä»¶æµ‹è¯• -->
        <div class="test-section">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <span class="mr-2">ğŸ¨</span> UIç»„ä»¶æµ‹è¯•
            </h2>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="window.open('http://localhost:3000', '_blank')" 
                        class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    æ‰“å¼€é¦–é¡µ
                </button>
                <button onclick="window.open('http://localhost:3000/login', '_blank')" 
                        class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    æ‰“å¼€ç™»å½•é¡µ
                </button>
                <button onclick="window.open('http://localhost:3000/register', '_blank')" 
                        class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    æ‰“å¼€æ³¨å†Œé¡µ
                </button>
                <button onclick="window.open('http://localhost:3000/profile', '_blank')" 
                        class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                    æ‰“å¼€ä¸ªäººèµ„æ–™é¡µ
                </button>
            </div>
            <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded">
                <p class="text-sm text-blue-800">
                    <strong>æ£€æŸ¥æ¸…å•:</strong><br>
                    âœ… Headerä¸­æ˜¯å¦æ˜¾ç¤º"ç™»å½•/æ³¨å†Œ"æŒ‰é’®(æœªç™»å½•)<br>
                    âœ… ç™»å½•é¡µé¢UIæ˜¯å¦æ­£å¸¸<br>
                    âœ… æ³¨å†Œé¡µé¢UIæ˜¯å¦æ­£å¸¸<br>
                    âœ… ä¸ªäººèµ„æ–™é¡µé¢æ˜¯å¦å—ä¿æŠ¤(æœªç™»å½•è·³è½¬)
                </p>
            </div>
        </div>

        <!-- APIç«¯ç‚¹æµ‹è¯• -->
        <div class="test-section">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <span class="mr-2">ğŸŒ</span> APIç«¯ç‚¹æµ‹è¯•
            </h2>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="testEndpoint('POST', '/api/auth/register')" 
                        class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                    æµ‹è¯•æ³¨å†ŒAPI
                </button>
                <button onclick="testEndpoint('POST', '/api/auth/login')" 
                        class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                    æµ‹è¯•ç™»å½•API
                </button>
                <button onclick="testEndpoint('GET', '/api/users/me')" 
                        class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                    æµ‹è¯•ç”¨æˆ·ä¿¡æ¯API
                </button>
                <button onclick="testEndpoint('POST', '/api/auth/logout')" 
                        class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                    æµ‹è¯•ç™»å‡ºAPI
                </button>
            </div>
            <div id="api-result"></div>
        </div>

        <!-- è®¤è¯æµç¨‹æµ‹è¯• -->
        <div class="test-section">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <span class="mr-2">ğŸ”</span> å®Œæ•´è®¤è¯æµç¨‹æµ‹è¯•
            </h2>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">æµ‹è¯•é‚®ç®±:</label>
                <input type="email" id="test-email" 
                       value="test@example.com" 
                       class="w-full px-3 py-2 border border-gray-300 rounded">
            </div>
            <div class="mb-4">
                <label class="block text-sm font-medium text-gray-700 mb-2">æµ‹è¯•å¯†ç :</label>
                <input type="password" id="test-password" 
                       value="TestPassword123!" 
                       class="w-full px-3 py-2 border border-gray-300 rounded">
            </div>
            <button onclick="runFullAuthTest()" 
                    class="bg-indigo-600 text-white px-6 py-3 rounded hover:bg-indigo-700 font-medium">
                è¿è¡Œå®Œæ•´æµ‹è¯•
            </button>
            <div id="auth-result"></div>
        </div>

        <!-- æµ‹è¯•æŠ¥å‘Š -->
        <div class="test-section">
            <h2 class="text-xl font-semibold mb-4 flex items-center">
                <span class="mr-2">ğŸ“Š</span> æµ‹è¯•æŠ¥å‘Š
            </h2>
            <div id="test-report" class="space-y-2"></div>
        </div>
    </div>

    <script>
        const BASE_URL = 'http://localhost:3000';
        let testResults = [];

        function addResult(name, passed, message = '') {
            testResults.push({ name, passed, message, timestamp: new Date() });
            updateReport();
        }

        function updateReport() {
            const reportDiv = document.getElementById('test-report');
            const passed = testResults.filter(r => r.passed).length;
            const total = testResults.length;
            
            reportDiv.innerHTML = `
                <div class="mb-4 p-4 bg-gray-100 rounded">
                    <p class="font-medium">æ€»è®¡: ${total} | é€šè¿‡: ${passed} | å¤±è´¥: ${total - passed}</p>
                    <div class="w-full bg-gray-300 rounded-full h-2 mt-2">
                        <div class="bg-green-600 h-2 rounded-full" style="width: ${total ? (passed/total*100) : 0}%"></div>
                    </div>
                </div>
                ${testResults.map(r => `
                    <div class="flex items-center justify-between p-2 ${r.passed ? 'bg-green-50' : 'bg-red-50'} rounded">
                        <span>${r.passed ? 'âœ…' : 'âŒ'} ${r.name}</span>
                        ${r.message ? `<span class="text-sm text-gray-600">${r.message}</span>` : ''}
                    </div>
                `).join('')}
            `;
        }

        async function checkConfig() {
            const resultDiv = document.getElementById('config-result');
            resultDiv.innerHTML = '<div class="test-result info">æ£€æŸ¥ä¸­...</div>';
            
            const checks = [];
            
            // æ£€æŸ¥å¼€å‘æœåŠ¡å™¨
            try {
                const response = await fetch(BASE_URL);
                checks.push({
                    name: 'å¼€å‘æœåŠ¡å™¨è¿è¡Œ',
                    passed: response.ok,
                    message: response.ok ? 'ç«¯å£3000æ­£å¸¸' : 'æ— æ³•è¿æ¥'
                });
            } catch (error) {
                checks.push({
                    name: 'å¼€å‘æœåŠ¡å™¨è¿è¡Œ',
                    passed: false,
                    message: 'è¯·å¯åŠ¨: npm run dev'
                });
            }
            
            // æ£€æŸ¥Supabaseé…ç½®
            const hasSupabase = typeof window !== 'undefined';
            checks.push({
                name: 'Supabaseé…ç½®',
                passed: hasSupabase,
                message: hasSupabase ? 'é…ç½®æ­£å¸¸' : 'ç¼ºå°‘é…ç½®'
            });
            
            checks.forEach(check => addResult(check.name, check.passed, check.message));
            
            resultDiv.innerHTML = `
                <div class="test-result ${checks.every(c => c.passed) ? 'success' : 'error'}">
                    ${checks.map(c => `${c.passed ? 'âœ…' : 'âŒ'} ${c.name}: ${c.message}`).join('<br>')}
                </div>
            `;
        }

        async function testEndpoint(method, path) {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = `<div class="test-result info">æµ‹è¯• ${method} ${path}...</div>`;
            
            try {
                const response = await fetch(BASE_URL + path, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                });
                
                let data;
                try {
                    data = await response.json();
                } catch {
                    data = { message: await response.text() };
                }
                
                const passed = response.status !== 404 && response.status !== 500;
                addResult(`API ${method} ${path}`, passed, `çŠ¶æ€: ${response.status}`);
                
                resultDiv.innerHTML = `
                    <div class="test-result ${passed ? 'success' : 'error'}">
                        <strong>${method} ${path}</strong><br>
                        çŠ¶æ€: ${response.status}<br>
                        å“åº”: ${JSON.stringify(data, null, 2)}
                    </div>
                `;
            } catch (error) {
                addResult(`API ${method} ${path}`, false, error.message);
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        é”™è¯¯: ${error.message}
                    </div>
                `;
            }
        }

        async function runFullAuthTest() {
            const email = document.getElementById('test-email').value;
            const password = document.getElementById('test-password').value;
            const resultDiv = document.getElementById('auth-result');
            
            resultDiv.innerHTML = '<div class="test-result info">è¿è¡Œå®Œæ•´è®¤è¯æµç¨‹æµ‹è¯•...</div>';
            
            const steps = [];
            
            try {
                // æ­¥éª¤1: æ³¨å†Œ
                steps.push('å¼€å§‹æ³¨å†Œ...');
                const registerResponse = await fetch(`${BASE_URL}/api/auth/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: `test_${Date.now()}@example.com`,
                        password,
                        username: `testuser_${Date.now()}`,
                        fullName: 'Test User'
                    })
                });
                
                const registerData = await registerResponse.json();
                const registerPassed = registerResponse.ok || registerResponse.status === 400;
                steps.push(`æ³¨å†Œ: ${registerPassed ? 'âœ…' : 'âŒ'} - ${JSON.stringify(registerData)}`);
                addResult('ç”¨æˆ·æ³¨å†Œ', registerPassed, registerData.message || '');
                
                // æ­¥éª¤2: ç™»å½•
                steps.push('å¼€å§‹ç™»å½•...');
                const loginResponse = await fetch(`${BASE_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    credentials: 'include',
                    body: JSON.stringify({ email, password })
                });
                
                const loginData = await loginResponse.json();
                const loginPassed = loginResponse.ok;
                steps.push(`ç™»å½•: ${loginPassed ? 'âœ…' : 'âŒ'} - ${JSON.stringify(loginData)}`);
                addResult('ç”¨æˆ·ç™»å½•', loginPassed, loginData.message || '');
                
                if (loginPassed) {
                    // æ­¥éª¤3: è·å–ç”¨æˆ·ä¿¡æ¯
                    steps.push('è·å–ç”¨æˆ·ä¿¡æ¯...');
                    const meResponse = await fetch(`${BASE_URL}/api/users/me`, {
                        credentials: 'include'
                    });
                    
                    const meData = await meResponse.json();
                    const mePassed = meResponse.ok;
                    steps.push(`ç”¨æˆ·ä¿¡æ¯: ${mePassed ? 'âœ…' : 'âŒ'}`);
                    addResult('è·å–ç”¨æˆ·ä¿¡æ¯', mePassed);
                    
                    // æ­¥éª¤4: ç™»å‡º
                    steps.push('å¼€å§‹ç™»å‡º...');
                    const logoutResponse = await fetch(`${BASE_URL}/api/auth/logout`, {
                        method: 'POST',
                        credentials: 'include'
                    });
                    
                    const logoutPassed = logoutResponse.ok;
                    steps.push(`ç™»å‡º: ${logoutPassed ? 'âœ…' : 'âŒ'}`);
                    addResult('ç”¨æˆ·ç™»å‡º', logoutPassed);
                }
                
                resultDiv.innerHTML = `
                    <div class="test-result success">
                        ${steps.map(s => `<div>${s}</div>`).join('')}
                    </div>
                `;
                
            } catch (error) {
                steps.push(`âŒ é”™è¯¯: ${error.message}`);
                resultDiv.innerHTML = `
                    <div class="test-result error">
                        ${steps.map(s => `<div>${s}</div>`).join('')}
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = () => {
            updateReport();
            console.log('OpenAero è®¤è¯æµ‹è¯•é¡µé¢å·²åŠ è½½');
            console.log('è¯·ç¡®ä¿å¼€å‘æœåŠ¡å™¨è¿è¡Œåœ¨: http://localhost:3000');
        };
    </script>
</body>
</html>
